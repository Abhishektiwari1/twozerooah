!function(e){e.fn.serializeObject=function(){"use strict";var a={};return e.each(this.serializeArray(),function(s,t){var r=a[t.name];void 0!==r&&null!==r?e.isArray(r)?r.push(t.value):a[t.name]=[r,t.value]:a[t.name]=t.value}),a}}(jQuery),function(e){window.WP_Users=window.WP_Users||{},window.WP_Users=e.extend({init:function(){var e=this;e.events_handle(),e.forms(),e.profile_avatar(),e.profile_cover()},events_handle:function(){var a=this;a.hide_all_errors(),e("body").on("click",".wpu-singup-btn, .wpu-login-btn",function(s){var t=e(s.target),r=t.is(".wpu-login-btn");return!(!r||!t.data("is-logged"))||(e(".wpu-modal").addClass("is-visible"),e("body").trigger("wp_users_before_open"),r?a.login_selected():a.signup_selected(),!1)}),e(document).keyup(function(e){"27"==e.which&&a.close_modal()}),e("body").on("click",".wpu-modal",function(s){var t=e(".wpu-modal");(e(s.target).is(t)||e(s.target).is(".wpu-close-form"))&&a.close_modal()}),e("body").on("click",".wpu-modal .wpu-close-form",function(e){a.close_modal()}),e("body").on("click",".wpu-modal .wpu-register-link",function(e){e.preventDefault(),a.signup_selected()}),e("body").on("click",".wpu-modal .wpu-login-link",function(e){e.preventDefault(),a.login_selected()}),e("body").on("click",".wpu-pwd-toggle .hide-password",function(a){a.preventDefault();var s=e(this),t=s.parent(),r=e("input",t);"password"==r.attr("type")?(r.attr("type","text"),s.text(WP_Users.hide_txt)):(r.attr("type","password"),s.text(WP_Users.show_txt));var i=r.val().length;r.focus(),r[0].setSelectionRange(i,i)}),e("body").on("click",".wpu-modal .wpu-lost-pwd-link",function(e){e.preventDefault(),a.forgot_password_selected()}),e("body").on("click",".wpu-modal .wpu-back-to-login",function(e){e.preventDefault(),a.login_selected()}),e(".wpu-register-form").hasClass("in-wpu-modal")&&e("body").on("click",".wpu-modal .wpu-login-link",function(e){e.preventDefault(),a.login_selected()})},close_modal:function(){e(".wpu-modal").removeClass("is-visible")},login_selected:function(){var a=e(".wpu-modal"),s=a.find("#wpu-login"),t=a.find("#wpu-signup"),r=a.find("#wpu-reset-password"),i=a.find("#wpu-change-password"),o=a.find(".wpu-login-link"),n=a.find(".wpu-register-link");s.addClass("is-selected"),t.removeClass("is-selected"),r.removeClass("is-selected"),i.removeClass("is-selected"),o.addClass("selected"),n.removeClass("selected")},signup_selected:function(){var a=e(".wpu-modal"),s=a.find("#wpu-login"),t=a.find("#wpu-signup"),r=a.find("#wpu-reset-password"),i=a.find("#wpu-change-password"),o=a.find(".wpu-login-link"),n=a.find(".wpu-register-link");s.removeClass("is-selected"),t.addClass("is-selected"),r.removeClass("is-selected"),i.removeClass("is-selected"),o.removeClass("selected"),n.addClass("selected")},forgot_password_selected:function(){var a=e(".wpu-modal"),s=a.find("#wpu-login"),t=a.find("#wpu-signup"),r=a.find("#wpu-reset-password"),i=a.find("#wpu-change-password");s.removeClass("is-selected"),t.removeClass("is-selected"),i.removeClass("is-selected"),r.addClass("is-selected")},hide_all_errors:function(){e("body").on("click",".wpu-form .fieldset",function(){var a=e(this);a.find("input").removeClass("has-error"),a.find("span").removeClass("is-visible")})},profile_avatar:function(){var a=this,s='<div class="wpu-media"><div class="cp-btn"><i class="cp-icon"></i><span>'+WP_Users.avatar_text+'</span> </div><div class="cp-actions"> <div class="cp-upload" id="profile">'+WP_Users.upload_text+'</div> <div class="cp-remove">'+WP_Users.remove_text+"</div> </div> </div>";e('.wpu-profile-avatar[data-change="true"]').each(function(){var t=e(s);e(this).append(t),a.handle_upload("avatar",t),e(".cp-remove",t).on("click",function(){return e.post(WP_Users.ajax_url,{_wpnonce:WP_Users._wpnonce,act:"remove_media",media_type:"avatar",action:"wp_users_ajax"},function(){var a=e(".wpu-profile-avatar").attr("data-default")||"";""!==a?e(".wpu-profile-avatar").css({backgroundImage:'url("'+a+'")'}):e(".wpu-profile-avatar").css({backgroundImage:""})}),e(".cp-actions",t).removeClass("cp-active"),!1})})},profile_cover:function(){var a=this,s='<div class="wpu-media"><div class="cp-btn"><i class="cp-icon"></i><span>'+WP_Users.cover_text+'</span> </div><div class="cp-actions"> <div class="cp-upload" id="profile">'+WP_Users.upload_text+'</div> <div class="cp-remove">'+WP_Users.remove_text+"</div> </div> </div>";e('.wpu-profile-cover[data-change="true"]').each(function(){var t=e(s);e(this).append(t),a.handle_upload("cover",t),e(".cp-remove",t).on("click",function(a){a.preventDefault(),e.post(WP_Users.ajax_url,{_wpnonce:WP_Users._wpnonce,act:"remove_media",media_type:"cover",action:"wp_users_ajax"},function(){var a=e(".wpu-profile-cover").attr("data-default")||"";""!==a?e(".wpu-profile-cover").css({backgroundImage:'url("'+a+'")'}):e(".wpu-profile-cover").css({backgroundImage:""})}),e(".cp-actions",t).removeClass("cp-active")})})},handle_upload:function(a,s){var t=this;e(document).mouseup(function(a){s.is(a.target)||0!==s.has(a.target).length||e(".cp-actions",s).removeClass("cp-active")}),e(".cp-btn",s).on("click",function(){e(".cp-actions",s).toggleClass("cp-active")}),e(".cp-upload",s).on("click",function(){t._upload_form(a)})},_upload_form:function(a){var s;e("#wpu_form_update_"+a).length>0&&e("#wpu_form_update_"+a).remove(),(s=e('<form style="display:none;" method="post" id="wpu_form_update_'+a+'" enctype="multipart/form-data" />')).append('<input type="hidden" name="_wpnonce" value="'+WP_Users._wpnonce+'"/>'),s.append('<input type="hidden" name="act" value="update_'+a+'"/>'),s.append('<input type="hidden" name="action" value="wp_users_ajax"/>'),s.append('<input type="hidden" name="redirect_url"/>'),s.append('<input type="file" name="img" class="upload-file">'),e("body").append(s),e('input[name="redirect_url"]').val(window.location),s.attr("action",WP_Users.ajax_url),e(".upload-file",s).trigger("click"),e(".upload-file",s).on("change",function(){switch(e(".upload-file",s).val().match(/\.(.+)$/)[1]){case"jpg":case"jpeg":case"png":case"gif":break;default:return alert(WP_Users.invalid_file_type),!1}s.submit()})},forms:function(){e(".wpu-login-form").submit(function(){var a=e(this),s=a.serializeObject();return s.action="wp_users_ajax",s.act="do_login",a.addClass("wpu-loading loading"),e(".wpu-error-msg",a).removeClass("is-visible"),e(".has-error",a).removeClass("has-error"),e.ajax({url:WP_Users.ajax_url,data:s,type:"POST",success:function(t){if(a.removeClass("wpu-loading loading"),"logged_success"!==t)try{var r=JSON.parse(t);e.each(r,function(s,t){if(e("."+s,a).length>0){var r=e("."+s,a);e(".wpu-error-msg",r).length<=0&&r.append('<span class="wpu-error-msg"></span>'),e(".wpu-error-msg",r).html(t).addClass("is-visible"),r.find("input").toggleClass("has-error")}})}catch(e){}else{var i=void 0!==typeof s.wpu_redirect_to&""!=s.wpu_redirect_to?s.wpu_redirect_to:window.location;window.location=i}}}),!1}),e(".wpu-register-form").submit(function(){var a=e(this),s=a.serializeObject();s.action="wp_users_ajax",s.act="do_register",0==e('input[name="wpu_accept_terms"]:checked',a).length&&e(".accept-terms .wpu-error-msg",a).toggleClass("is-visible");var t=e('input[type="submit"], button[type="submit"]',a),r=t.val();return t.data("default-text",r),""!==t.data("loading-text")&&(t.val(t.data("loading-text")),t.attr("disabled","disabled")),a.addClass("wpu-loading loading"),e(".wpu-error-msg",a).removeClass("is-visible"),e(".has-error",a).removeClass("has-error"),e.ajax({url:WP_Users.ajax_url,data:s,type:"POST",success:function(r){if(a.removeClass("wpu-loading loading"),t.val(t.data("default-text")),t.removeAttr("disabled"),!isNaN(r)){void 0!==s.wpu_redirect_to&""!=s.wpu_redirect_to?s.wpu_redirect_to:window.location;return e("input[type=text], input[type=email], input[type=password], input[type=number]",a).val(""),e("input[type=checkbox]",a).removeAttr("checked"),void e(".wpu-msg",a).show(0)}try{var i=JSON.parse(r);e.each(i,function(s,t){if(e("."+s,a).length>0){var r=e("."+s,a);e(".wpu-error-msg",r).length<=0&&r.append('<span class="wpu-error-msg"></span>'),e(".wpu-error-msg",r).html(t).addClass("is-visible"),r.find("input").toggleClass("has-error")}})}catch(e){}}}),!1}),e(".wpu-form-reset-password").submit(function(){var a=e(this),s=a.serializeObject();s.action="wp_users_ajax",s.act="retrieve_password";var t=e('input[type="submit"], button[type="submit"]',a),r=t.val();return t.data("default-text",r),""!==t.data("loading-text")&&(t.val(t.data("loading-text")),t.attr("disabled","disabled")),a.addClass("wpu-loading loading"),e(".wpu-error-msg",a).removeClass("is-visible"),e(".has-error",a).removeClass("has-error"),e.ajax({url:WP_Users.ajax_url,data:s,type:"POST",success:function(s){if(a.removeClass("wpu-loading loading"),t.val(t.data("default-text")),t.removeAttr("disabled"),"sent"==s)e("input[type=text], input[type=email], input[type=password], input[type=number]",a).val(""),e("input[type=checkbox]",a).removeAttr("checked"),e(".wpu-msg",a).show(100);else try{var r=JSON.parse(s);e.each(r,function(s,t){if(e("."+s,a).length>0){var r=e("."+s,a);e(".wpu-error-msg",r).length<=0&&r.append('<span class="wpu-error-msg"></span>'),e(".wpu-error-msg",r).html(t).addClass("is-visible"),r.find("input").toggleClass("has-error")}})}catch(t){e(".wpu-msg",a).addClass("has-error").html(s).show()}}}),!1}),e(".wpu-form-change-password").submit(function(){var a=e(this),s=a.serializeObject();s.action="wp_users_ajax",s.act="do_reset_pass";var t=e('input[type="submit"], button[type="submit"]',a),r=t.val();return t.data("default-text",r),""!==t.data("loading-text")&&(t.val(t.data("loading-text")),t.attr("disabled","disabled")),e(".wpu-msg",a).hide(1),a.addClass("wpu-loading loading"),e(".has-error",a).removeClass("has-error"),e.ajax({url:WP_Users.ajax_url,data:s,type:"POST",success:function(s){if(a.removeClass("wpu-loading loading"),t.val(t.data("default-text")),t.removeAttr("disabled"),"changed"==s)e("input[type=text], input[type=email], input[type=password], input[type=number]",a).val(""),e(".wpu-msg",a).show(1);else try{var r=JSON.parse(s);e(".wpu-msg",a).hide(1),void 0!==r.error&&""!==r.error&&e(".wpu-errors-msg",a).html(r.error).show(1),e.each(r,function(s,t){var r=e("."+s,a);e(".wpu-error-msg",r).html(t).toggleClass("is-visible"),r.find(".input").toggleClass("has-error")})}catch(e){}}}),!1}),e("form.wpu-form-profile").submit(function(){var a=e(this),s=a.serializeObject();s.action="wp_users_ajax",s.act="do_update_profile";var t=e('input[type="submit"], button[type="submit"]',a),r=t.val();return t.data("default-text",r),""!==t.data("loading-text")&&(t.val(t.data("loading-text")),t.attr("disabled","disabled")),e(".wpu-msg",a).hide(1),a.addClass("wpu-loading loading"),e.ajax({url:WP_Users.ajax_url,data:s,type:"POST",success:function(s){if(a.removeClass("wpu-loading loading"),t.val(t.data("default-text")),t.removeAttr("disabled"),"updated"==s){var r=window.location.href;-1==r.indexOf("wpu_profile_updated")&&(-1!==r.indexOf("?")?r+="&wpu_profile_updated=1":r+="?wpu_profile_updated=1"),window.location=r,e(".wpu-msg",a).show(1)}else try{var i=JSON.parse(s);e(".wpu-msg",a).hide(1),void 0!==i.error&&""!==i.error&&e(".wpu-errors-msg",a).html(i.error).show(1),e.each(i,function(s,t){var r=e("."+s,a);e(".wpu-error-msg",r).html(t).toggleClass("is-visible"),r.find(".input").toggleClass("has-error")})}catch(e){}}}),!1})}},window.WP_Users),e.fn.wp_users=function(){return this.each(function(){return window.WP_Users.init()})},e("body").wp_users()}(jQuery);